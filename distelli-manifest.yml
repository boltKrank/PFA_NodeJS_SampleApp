seteam/PFA_NodeJS_SampleApp:
  # This Basic Distelli Manifest assumes the following
  # has been provisioned on the destination deploy server

  PkgInclude:
    - 'Boltdir/'
    - 'server.js'
  PreInstall:
    - sudo rpm -Uvh https://yum.puppet.com/puppet5/puppet5-release-el-7.noarch.rpm || true
    - sudo yum install -y puppet-bolt
  PostInstall:
    - sudo /usr/local/bin/bolt puppetfile install
    - sudo /usr/local/bin/bolt plan run sampleapp::prereqs
  Exec:
    - publicip=$(curl -s ident.me) || true
    - 'echo "****************************************************************"'
    - 'echo     "NodeJS application will start on: http://$publicip"'
    - 'echo "****************************************************************"'
    - exec node server.js
  PostStart:
    - publicip=$(curl -s ident.me) || true
    - curl -s "http://$publicip" | grep 'Your Node.js application is working!'
